#include "stdafx.h"

int main(int argc, char *argv[]) {

	BOOL success = true;

	Memory* MemoryManager = new Memory();
	DWORD64 ntoskrnlBaseAddress = MemoryManager->GetKernelBase("ntoskrnl.exe");

	//Gets a pointer to the EPROCESS of explorer
	std::string processName = "explorer.exe";
	DWORD64 peprocess = MemoryManager->GetEPROCESSPointer(ntoskrnlBaseAddress, processName);

	if (peprocess == NULL) {
		Logger::Info("Failed to get EPROCESS of process!");
		Logger::ShowKeyPress();
		exit(1);
	}
	
	Logger::InfoHex("EPROCESS Address", peprocess);

	DWORD64 tableBase{};
	MemoryManager->VirtualRead(peprocess + EPROCESS_DIRECTORYTABLEBASE, &tableBase, sizeof(DWORD64));
	Logger::InfoHex("Table Base Address", tableBase);

	DWORD64 testPhysAddress{0};
	DWORD64 testPhysRead{};
	MemoryManager->PhysicalRead(tableBase, &testPhysRead, sizeof(DWORD64));
	Logger::InfoHex("Test Phys Read", testPhysRead);

	Logger::ShowKeyPress();

}